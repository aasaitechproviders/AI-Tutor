<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    
    <title>Aasai SmartEDU - AI Learning Assistant</title>
    <meta name="description" content="AI-powered learning assistant for school students aged 8-17.">
    
    <!-- MathJax Configuration - MUST come before loading MathJax -->
    <script>
    window.MathJax = {
        tex: {
            inlineMath: [['\\(', '\\)']],
            displayMath: [['\\[', '\\]']],
            processEscapes: true,
            processEnvironments: true
        },
        options: {
            skipHtmlTags: ['script', 'noscript', 'style', 'textarea', 'pre']
        },
        startup: {
            ready: () => {
                console.log('MathJax is loaded and configured');
                MathJax.startup.defaultReady();
                console.log('MathJax startup complete');
            }
        }
    };
    </script>
    
    <!-- Load MathJax -->
    <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml.js" id="MathJax-script" async></script>
    
    <!-- Marked.js for Markdown parsing -->
    <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
    
    <!-- Google Sign-In -->
    <script src="https://accounts.google.com/gsi/client" async defer></script>
    
    <style>
        :root {
            --primary: #4361ee;
            --secondary: #3a0ca3;
            --accent: #7209b7;
            --light: #f8f9fa;
            --dark: #212529;
            --success: #4cc9f0;
            --warning: #f72585;
            --gray: #6c757d;
            --light-gray: #e9ecef;
        }
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
        }
        
        body {
            background: linear-gradient(135deg, #f5f7fb 0%, #c3cfe2 100%);
            color: var(--dark);
            line-height: 1.6;
            min-height: 100vh;
            display: flex;
            flex-direction: column;
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 0 20px;
        }
        
        /* Header */
        header {
            background: linear-gradient(135deg, var(--primary), var(--secondary));
            color: white;
            padding: 1rem 0;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.1);
            position: sticky;
            top: 0;
            z-index: 100;
        }
        
        .header-content {
            display: flex;
            justify-content: space-between;
            align-items: center;
            min-height: 60px;
        }
        
        .logo {
            font-size: 1.5rem;
            font-weight: 700;
            display: flex;
            align-items: center;
        }
        
        .logo-icon {
            margin-right: 10px;
            font-size: 1.8rem;
        }
        
        .auth-container {
            display: flex;
            align-items: center;
            gap: 1rem;
        }
        
        .user-profile {
            display: none;
            align-items: center;
            gap: 0.8rem;
            background: rgba(255, 255, 255, 0.1);
            padding: 0.5rem 1rem;
            border-radius: 25px;
        }
        
        .user-profile.show {
            display: flex;
        }
        
        .user-avatar {
            width: 32px;
            height: 32px;
            border-radius: 50%;
            border: 2px solid white;
        }
        
        .user-info {
            display: flex;
            flex-direction: column;
        }
        
        .user-name {
            font-weight: 600;
            font-size: 0.9rem;
        }
        
        .user-email {
            font-size: 0.75rem;
            opacity: 0.8;
        }
        
        .user-stats {
            font-size: 0.7rem;
            opacity: 0.8;
            margin-top: 2px;
        }
        
        .sign-out-btn {
            background: rgba(255, 255, 255, 0.2);
            border: 1px solid rgba(255, 255, 255, 0.3);
            color: white;
            padding: 0.5rem 1rem;
            border-radius: 20px;
            cursor: pointer;
            font-size: 0.85rem;
            transition: all 0.3s;
        }
        
        .sign-out-btn:hover {
            background: rgba(255, 255, 255, 0.3);
        }

        /* Main content */
        main {
            flex: 1;
            padding: 2rem 0;
        }

        .main-layout {
            display: flex;
            flex-direction: column;
            gap: 2rem;
        }

        /* Mode Toggle Section */
        .mode-toggle-section {
            background: white;
            border-radius: 20px;
            padding: 2rem;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
        }

        .mode-toggle-header {
            text-align: center;
            margin-bottom: 2rem;
        }

        .mode-toggle-title {
            font-size: 1.8rem;
            font-weight: 600;
            color: var(--primary);
            margin-bottom: 0.5rem;
        }

        .mode-toggle-subtitle {
            color: var(--gray);
            font-size: 1rem;
        }

        .mode-buttons {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 2rem;
            margin-bottom: 2rem;
        }

        .mode-btn {
            background: linear-gradient(135deg, #f8f9ff 0%, #ffffff 100%);
            border: 2px solid var(--light-gray);
            border-radius: 16px;
            padding: 2rem;
            cursor: pointer;
            transition: all 0.3s;
            text-align: center;
            position: relative;
        }

        .mode-btn:hover {
            transform: translateY(-3px);
            box-shadow: 0 8px 30px rgba(0, 0, 0, 0.1);
            border-color: var(--primary);
        }

        .mode-btn.active {
            border-color: var(--primary);
            background: linear-gradient(135deg, #e8f0ff 0%, #f8f9ff 100%);
        }

        .mode-btn.active::before {
            content: '✓';
            position: absolute;
            top: 1rem;
            right: 1rem;
            background: var(--primary);
            color: white;
            width: 24px;
            height: 24px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 0.8rem;
            font-weight: bold;
        }

        .mode-icon {
            font-size: 3rem;
            margin-bottom: 1rem;
        }

        .mode-title {
            font-size: 1.3rem;
            font-weight: 600;
            color: var(--primary);
            margin-bottom: 0.5rem;
        }

        .mode-description {
            color: var(--gray);
            font-size: 0.9rem;
            line-height: 1.5;
        }

        /* Course Selection Panel */
        .course-selection-panel {
            display: none;
            background: var(--light);
            border-radius: 12px;
            padding: 1.5rem;
            margin-top: 1rem;
        }

        .course-selection-panel.show {
            display: block;
        }

        .course-selection-title {
            font-size: 1.1rem;
            font-weight: 600;
            color: var(--secondary);
            margin-bottom: 1rem;
            text-align: center;
        }

        .selectors-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 1rem;
        }

        .selector-group {
            display: flex;
            flex-direction: column;
        }

        .selector-group label {
            font-size: 0.9rem;
            font-weight: 500;
            color: var(--dark);
            margin-bottom: 0.5rem;
        }

        .form-select {
            padding: 0.75rem;
            border: 2px solid var(--light-gray);
            border-radius: 8px;
            font-size: 0.9rem;
            background-color: white;
            transition: border-color 0.3s;
            cursor: pointer;
        }

        .form-select:focus {
            outline: none;
            border-color: var(--primary);
        }

        /* Search Section */
        .search-container {
            background: white;
            border-radius: 20px;
            padding: 2rem;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
            display: none;
            min-height: 400px;
        }

        .search-container.show {
            display: block;
        }

        .search-header {
            text-align: center;
            margin-bottom: 2rem;
        }

        .search-title {
            font-size: 1.8rem;
            font-weight: 600;
            color: var(--primary);
            margin-bottom: 0.5rem;
        }

        .search-subtitle {
            color: var(--gray);
            font-size: 1rem;
        }

        /* Language Selector */
        .language-selector {
            display: flex;
            justify-content: center;
            align-items: center;
            gap: 1rem;
            margin-bottom: 1.5rem;
            padding: 1rem;
            background: var(--light);
            border-radius: 12px;
        }

        .language-selector label {
            font-weight: 600;
            color: var(--primary);
        }

        .language-select {
            padding: 0.5rem 1rem;
            border: 2px solid var(--primary);
            border-radius: 8px;
            font-size: 0.9rem;
            background-color: white;
            cursor: pointer;
            transition: all 0.3s;
        }

        .language-select:hover {
            background: var(--primary);
            color: white;
        }

        .search-box {
            display: flex;
            margin-bottom: 1rem;
            box-shadow: 0 4px 20px rgba(67, 97, 238, 0.15);
            border-radius: 12px;
            overflow: hidden;
            position: relative;
        }

        .search-input {
            flex: 1;
            padding: 1.2rem 1.5rem;
            border: none;
            font-size: 1.1rem;
            outline: none;
            background: white;
        }

        .search-input::placeholder {
            color: var(--gray);
        }

        /* Voice Button */
        .voice-btn {
            background: linear-gradient(135deg, var(--accent), var(--secondary));
            color: white;
            border: none;
            padding: 0 1.5rem;
            cursor: pointer;
            font-size: 1.5rem;
            transition: all 0.3s;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .voice-btn:hover {
            background: linear-gradient(135deg, var(--secondary), var(--primary));
        }

        .voice-btn.recording {
            background: var(--warning);
            animation: pulse 1.5s infinite;
        }

        @keyframes pulse {
            0%, 100% {
                opacity: 1;
            }
            50% {
                opacity: 0.7;
            }
        }

        .search-btn {
            background: linear-gradient(135deg, var(--primary), var(--secondary));
            color: white;
            border: none;
            padding: 0 2rem;
            cursor: pointer;
            font-weight: 600;
            font-size: 1.1rem;
            transition: all 0.3s;
        }

        .search-btn:hover {
            background: linear-gradient(135deg, var(--secondary), var(--accent));
        }

        .search-btn:disabled {
            opacity: 0.6;
            cursor: not-allowed;
        }

        /* Voice Status */
        .voice-status {
            text-align: center;
            padding: 0.5rem;
            margin-bottom: 1rem;
            border-radius: 8px;
            font-size: 0.9rem;
            display: none;
        }

        .voice-status.show {
            display: block;
        }

        .voice-status.listening {
            background: #fff3cd;
            color: #856404;
        }

        .voice-status.processing {
            background: #d1ecf1;
            color: #0c5460;
        }

        /* Results Section */
        .results-container {
            background: white;
            border-radius: 20px;
            padding: 2rem;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
            margin-top: 2rem;
            display: none;
        }

        .results-container.show {
            display: block;
        }

        .results-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1.5rem;
            padding-bottom: 1rem;
            border-bottom: 2px solid var(--light-gray);
        }

        .results-title {
            font-size: 1.8rem;
            font-weight: 600;
            color: var(--primary);
        }

        .result-card {
            padding: 2rem;
            border: 2px solid var(--light-gray);
            border-radius: 16px;
            margin-bottom: 1rem;
            transition: all 0.3s;
            background: linear-gradient(135deg, #ffffff 0%, #f8f9ff 100%);
        }

        .result-card:hover {
            transform: translateY(-3px);
            box-shadow: 0 8px 30px rgba(0, 0, 0, 0.1);
            border-color: var(--primary);
        }

        .result-question {
            background: #f0f7ff;
            border-left: 4px solid var(--primary);
            padding: 1rem 1.5rem;
            margin-bottom: 1.5rem;
            border-radius: 8px;
        }

        .result-question-label {
            font-size: 0.8rem;
            font-weight: 600;
            color: var(--primary);
            text-transform: uppercase;
            letter-spacing: 0.5px;
            margin-bottom: 0.5rem;
        }

        .result-question-text {
            font-size: 1.1rem;
            font-weight: 500;
            color: var(--dark);
            line-height: 1.5;
        }

        .result-title {
            font-size: 1.3rem;
            font-weight: 600;
            margin-bottom: 1rem;
            color: var(--primary);
        }

        .result-meta {
            display: flex;
            gap: 1rem;
            margin-bottom: 1rem;
            font-size: 0.9rem;
            color: var(--gray);
            flex-wrap: wrap;
        }

        .confidence-badge {
            padding: 0.3rem 0.8rem;
            border-radius: 15px;
            font-size: 0.8rem;
            font-weight: 600;
        }

        .confidence-high {
            background-color: #e6f4ea;
            color: #137333;
        }

        .confidence-medium {
            background-color: #fff8e1;
            color: #f57c00;
        }

        .confidence-low {
            background-color: #fce8e6;
            color: #c5221f;
        }

        /* FORMATTED CONTENT STYLES */
        .formatted-content {
            line-height: 1.6;
            color: var(--dark);
            font-size: 1.05rem;
        }

        .formatted-content h1 {
            font-size: 2rem;
            font-weight: 700;
            color: var(--primary);
            margin: 1.2rem 0 0.8rem 0;
            padding-bottom: 0.5rem;
            border-bottom: 3px solid var(--primary);
            line-height: 1.3;
        }

        .formatted-content h2 {
            font-size: 1.6rem;
            font-weight: 600;
            color: var(--secondary);
            margin: 1rem 0 0.6rem 0;
            padding-bottom: 0.3rem;
            border-bottom: 2px solid var(--light-gray);
            line-height: 1.3;
        }

        .formatted-content h3 {
            font-size: 1.3rem;
            font-weight: 600;
            color: var(--accent);
            margin: 0.8rem 0 0.5rem 0;
            line-height: 1.3;
        }

        .formatted-content h4 {
            font-size: 1.1rem;
            font-weight: 600;
            color: var(--primary);
            margin: 0.7rem 0 0.4rem 0;
            line-height: 1.3;
        }

        .formatted-content p {
            margin-bottom: 0.8rem;
            line-height: 1.6;
        }

        .formatted-content br {
            display: block;
            content: "";
            margin: 0.3rem 0;
        }

        .formatted-content ul,
        .formatted-content ol {
            margin: 0.8rem 0 0.8rem 2rem;
            padding-left: 1rem;
        }

        .formatted-content li {
            margin-bottom: 0.4rem;
            line-height: 1.5;
        }

        .formatted-content ul li {
            list-style-type: none;
            position: relative;
            padding-left: 1.5rem;
        }

        .formatted-content ul li::before {
            content: "";
            position: absolute;
            left: 0;
            top: 0.5rem;
            width: 8px;
            height: 8px;
            background: linear-gradient(135deg, var(--primary), var(--accent));
            border-radius: 50%;
            box-shadow: 0 2px 4px rgba(67, 97, 238, 0.3);
        }

        .formatted-content ol li {
            list-style-type: none;
            position: relative;
            padding-left: 2rem;
            counter-increment: item;
        }

        .formatted-content ol {
            counter-reset: item;
        }

        .formatted-content ol li::before {
            content: counter(item);
            position: absolute;
            left: 0;
            top: 0;
            background: linear-gradient(135deg, var(--primary), var(--secondary));
            color: white;
            width: 24px;
            height: 24px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 0.75rem;
            font-weight: 600;
            box-shadow: 0 2px 6px rgba(67, 97, 238, 0.3);
        }

        .formatted-content table {
            width: 100%;
            border-collapse: collapse;
            margin: 1.5rem 0;
            background: white;
            border-radius: 8px;
            overflow: hidden;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
        }

        .formatted-content thead {
            background: linear-gradient(135deg, var(--primary), var(--secondary));
            color: white;
        }

        .formatted-content th {
            padding: 1rem;
            text-align: left;
            font-weight: 600;
            border: 1px solid rgba(255, 255, 255, 0.2);
        }

        .formatted-content td {
            padding: 0.9rem 1rem;
            border: 1px solid var(--light-gray);
        }

        .formatted-content tbody tr:nth-child(even) {
            background-color: #f8f9fa;
        }

        .formatted-content tbody tr:hover {
            background-color: #e8f0ff;
        }

        .formatted-content strong {
            font-weight: 700;
            color: var(--primary);
        }

        .formatted-content em {
            font-style: italic;
            color: var(--secondary);
        }

        .formatted-content code {
            background: #2d2d2d;
            color: #f8f8f2;
            padding: 0.2rem 0.4rem;
            border-radius: 4px;
            font-family: 'Courier New', Courier, monospace;
            font-size: 0.9em;
        }

        .formatted-content pre {
            background: #2d2d2d;
            color: #f8f8f2;
            padding: 1.5rem;
            border-radius: 8px;
            overflow-x: auto;
            margin: 1rem 0;
        }

        .formatted-content pre code {
            background: transparent;
            padding: 0;
        }

        .formatted-content blockquote {
            border-left: 4px solid var(--primary);
            padding: 1rem 1.5rem;
            margin: 1rem 0;
            background: #f0f7ff;
            border-radius: 0 8px 8px 0;
            font-style: italic;
            color: var(--gray);
        }

        .formatted-content hr {
            border: none;
            border-top: 2px solid var(--light-gray);
            margin: 2rem 0;
        }

        .formatted-content a {
            color: var(--primary);
            text-decoration: underline;
            transition: color 0.3s;
        }

        .formatted-content a:hover {
            color: var(--secondary);
        }

        /* Math display styling */
        .formatted-content .math-display {
            text-align: center;
            margin: 1.5rem 0;
            font-size: 1.2em;
            padding: 1rem;
            background: #f8f9ff;
            border-radius: 8px;
        }

        .result-actions {
            display: flex;
            gap: 1rem;
            margin-top: 1.5rem;
            padding-top: 1rem;
            border-top: 1px solid var(--light-gray);
            flex-wrap: wrap;
            align-items: center;
        }

        .action-btn {
            background: var(--light);
            border: 2px solid var(--light-gray);
            color: var(--primary);
            cursor: pointer;
            font-weight: 500;
            display: flex;
            align-items: center;
            gap: 0.5rem;
            transition: all 0.3s;
            padding: 0.5rem 1rem;
            border-radius: 12px;
        }

        .action-btn:hover {
            background: var(--primary);
            color: white;
            border-color: var(--primary);
        }

        /* Speaker Button */
        .speaker-btn {
            background: linear-gradient(135deg, var(--success), #3a86ff);
            border: none;
            color: white;
            cursor: pointer;
            font-weight: 500;
            display: flex;
            align-items: center;
            gap: 0.5rem;
            transition: all 0.3s;
            padding: 0.5rem 1rem;
            border-radius: 12px;
            font-size: 0.9rem;
        }

        .speaker-btn:hover {
            background: linear-gradient(135deg, #3a86ff, var(--success));
            transform: translateY(-2px);
        }

        .speaker-btn.speaking {
            background: var(--warning);
            animation: pulse 1.5s infinite;
        }

        .speaker-btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }

        .feedback-btn {
            background: white;
            border: 2px solid var(--light-gray);
            color: var(--gray);
            cursor: pointer;
            font-weight: 500;
            display: flex;
            align-items: center;
            gap: 0.5rem;
            transition: all 0.3s;
            padding: 0.5rem 1rem;
            border-radius: 12px;
            font-size: 0.9rem;
        }

        .feedback-btn:hover {
            border-color: var(--primary);
            color: var(--primary);
            transform: translateY(-2px);
        }

        .feedback-btn.active-like {
            background: #e6f4ea;
            border-color: #137333;
            color: #137333;
        }

        .feedback-btn.active-dislike {
            background: #fce8e6;
            border-color: #c5221f;
            color: #c5221f;
        }

        .feedback-btn.active-report {
            background: #fff8e1;
            border-color: #f57c00;
            color: #f57c00;
        }

        .feedback-btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }

        .response-time {
            font-size: 0.8rem;
            color: var(--gray);
            padding: 0.3rem 0.6rem;
            background: var(--light);
            border-radius: 12px;
            display: flex;
            align-items: center;
            gap: 0.3rem;
        }

        .no-results {
            text-align: center;
            padding: 3rem;
            color: var(--gray);
        }

        .loading {
            display: flex;
            justify-content: center;
            padding: 3rem;
        }

        .spinner {
            width: 40px;
            height: 40px;
            border: 4px solid var(--light-gray);
            border-top: 4px solid var(--primary);
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .cache-indicator {
            font-size: 0.8rem;
            padding: 0.3rem 0.6rem;
            border-radius: 12px;
            background-color: var(--light);
            color: var(--gray);
        }

        .cache-hit {
            background-color: #e6f4ea;
            color: #137333;
        }

        /* Chat History */
        .chat-history-search {
            margin-top: 2rem;
            padding-top: 2rem;
            border-top: 1px solid var(--light-gray);
        }

        .chat-history-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1rem;
        }

        .chat-history-title {
            font-size: 1.3rem;
            font-weight: 600;
            color: var(--primary);
        }

        .refresh-btn {
            background: none;
            border: none;
            cursor: pointer;
            font-size: 1.2rem;
            color: var(--primary);
            padding: 0.5rem;
            border-radius: 50%;
            transition: all 0.3s;
        }

        .refresh-btn:hover {
            background: var(--light);
        }

        .chat-messages-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 1rem;
            max-height: 400px;
            overflow-y: auto;
        }

        .chat-message-item {
            padding: 1rem;
            background: var(--light);
            border-radius: 12px;
            cursor: pointer;
            transition: all 0.3s;
            border-left: 3px solid transparent;
        }

        .chat-message-item:hover {
            background: #e8f0ff;
            border-left-color: var(--primary);
            transform: translateX(3px);
        }

        .chat-question {
            font-size: 0.9rem;
            font-weight: 600;
            margin-bottom: 0.5rem;
        }

        .chat-answer {
            font-size: 0.8rem;
            color: var(--gray);
            margin-bottom: 0.5rem;
        }

        .chat-message-meta {
            font-size: 0.75rem;
            color: var(--gray);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .no-chat-history {
            text-align: center;
            color: var(--gray);
            font-style: italic;
            padding: 2rem 0;
            grid-column: 1/-1;
        }

        .load-more-btn {
            width: 100%;
            padding: 0.8rem;
            background: var(--light);
            border: 1px solid var(--light-gray);
            border-radius: 12px;
            color: var(--gray);
            cursor: pointer;
            font-size: 0.9rem;
            margin-top: 1rem;
            transition: all 0.3s;
        }

        .load-more-btn:hover {
            background: var(--primary);
            color: white;
            border-color: var(--primary);
        }

        /* Units Container */
        .units-container {
            background: white;
            border-radius: 20px;
            padding: 2rem;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
            display: none;
        }

        .units-container.show {
            display: block;
        }

        .units-header {
            text-align: center;
            margin-bottom: 2rem;
        }

        .units-title {
            font-size: 1.8rem;
            font-weight: 600;
            color: var(--primary);
            margin-bottom: 0.5rem;
        }

        .course-info {
            background: linear-gradient(135deg, var(--primary), var(--secondary));
            color: white;
            padding: 1rem;
            border-radius: 12px;
            margin-bottom: 1.5rem;
            text-align: center;
        }

        .course-info h4 {
            font-size: 1.2rem;
            margin-bottom: 0.5rem;
        }

        .course-info p {
            opacity: 0.9;
            font-size: 0.9rem;
        }

        .units-grid {
            display: grid;
            grid-template-columns: 1fr;
            gap: 1.5rem;
        }

        .unit-card {
            background: white;
            border: 2px solid var(--light-gray);
            border-radius: 16px;
            overflow: hidden;
            transition: all 0.3s;
            max-width: 100%;
        }

        .unit-card:hover {
            border-color: var(--primary);
            box-shadow: 0 4px 20px rgba(67, 97, 238, 0.15);
        }

        .unit-header {
            background: linear-gradient(135deg, #f8f9ff 0%, #ffffff 100%);
            padding: 1.5rem;
            cursor: pointer;
            display: flex;
            justify-content: space-between;
            align-items: center;
            transition: all 0.3s;
            border-bottom: 2px solid transparent;
        }

        .unit-header:hover {
            background: linear-gradient(135deg, #e8f0ff 0%, #f8f9ff 100%);
        }

        .unit-header.active {
            background: linear-gradient(135deg, var(--primary), var(--secondary));
            border-bottom-color: var(--primary);
        }

        .unit-title {
            font-size: 1.2rem;
            font-weight: 600;
            color: var(--primary);
            margin: 0;
            display: flex;
            align-items: center;
            gap: 0.5rem;
            overflow-wrap: break-word;
            word-wrap: break-word;
            min-width: 0;
        }

        .unit-header.active .unit-title {
            color: white;
        }

        .unit-icon {
            font-size: 1.5rem;
            flex-shrink: 0;
        }

        .unit-toggle {
            background: var(--primary);
            color: white;
            border: none;
            width: 32px;
            height: 32px;
            border-radius: 8px;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.3rem;
            font-weight: 300;
            transition: all 0.3s;
            flex-shrink: 0;
        }

        .unit-header.active .unit-toggle {
            background: white;
            color: var(--primary);
        }

        .unit-content {
            max-height: 0;
            overflow: hidden;
            transition: max-height 0.4s ease-out;
        }

        .unit-content.show {
            max-height: 10000px;
            transition: max-height 0.5s ease-in;
        }

        .question-section {
            padding: 1.5rem;
            border-bottom: 1px solid var(--light-gray);
        }

        .question-section:last-child {
            border-bottom: none;
        }

        .question-section-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1rem;
            padding-bottom: 0.5rem;
            border-bottom: 2px solid var(--light-gray);
        }

        .question-type-title {
            font-size: 1rem;
            font-weight: 600;
            color: var(--secondary);
        }

        .question-count {
            background: var(--primary);
            color: white;
            padding: 0.3rem 0.8rem;
            border-radius: 20px;
            font-size: 0.8rem;
            font-weight: 600;
        }

        .questions-list {
            display: flex;
            flex-direction: column;
            gap: 0.8rem;
        }

        .question-item {
            background: var(--light);
            padding: 0;
            border-radius: 12px;
            transition: all 0.3s;
            border: 2px solid transparent;
            overflow: hidden;
            max-width: 100%;
        }

        .question-item:hover {
            border-color: var(--primary);
            box-shadow: 0 4px 15px rgba(67, 97, 238, 0.15);
        }

        .question-header {
            padding: 1rem;
            cursor: pointer;
            display: flex;
            justify-content: space-between;
            align-items: center;
            gap: 1rem;
            background: var(--light);
            transition: all 0.3s;
        }

        .question-header:hover {
            background: #e8f0ff;
        }

        .question-header.active {
            background: #e8f0ff;
        }

        .question-left {
            flex: 1;
            display: flex;
            align-items: center;
            gap: 0.8rem;
            min-width: 0;
        }

        .question-number {
            background: linear-gradient(135deg, var(--primary), var(--secondary));
            color: white;
            width: 28px;
            height: 28px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 0.8rem;
            font-weight: 600;
            flex-shrink: 0;
        }

        .question-text {
            font-size: 0.9rem;
            font-weight: 500;
            color: var(--dark);
            line-height: 1.4;
            overflow-wrap: break-word;
            word-wrap: break-word;
            min-width: 0;
        }

        .question-toggle {
            background: var(--light-gray);
            color: var(--dark);
            border: none;
            width: 28px;
            height: 28px;
            border-radius: 6px;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.1rem;
            font-weight: 300;
            transition: all 0.3s;
            flex-shrink: 0;
        }

        .question-header.active .question-toggle {
            background: var(--primary);
            color: white;
        }

        .question-answer {
            max-height: 0;
            overflow: hidden;
            transition: max-height 0.3s ease-out;
            background: white;
            border-top: 1px solid var(--light-gray);
        }

        .question-answer.show {
            max-height: 10000px;
            transition: max-height 0.5s ease-in;
        }

        .answer-content {
            padding: 1.5rem;
            color: var(--dark);
            line-height: 1.6;
        }

        .answer-content .formatted-content {
            font-size: 0.9rem;
        }

        .answer-actions {
            display: flex;
            gap: 0.8rem;
            margin-top: 1rem;
            padding-top: 1rem;
            border-top: 1px solid var(--light-gray);
            flex-wrap: wrap;
        }

        .answer-actions .action-btn {
            font-size: 0.8rem;
            padding: 0.4rem 0.8rem;
        }

        /* Footer */
        footer {
            background: var(--dark);
            color: white;
            padding: 2rem 0;
            margin-top: 2rem;
        }

        .footer-content {
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .footer-logo {
            font-size: 1.2rem;
            font-weight: 700;
        }

        .footer-links {
            display: flex;
            gap: 1.5rem;
        }

        .footer-link {
            color: white;
            text-decoration: none;
            font-size: 0.9rem;
            transition: opacity 0.3s;
        }

        .footer-link:hover {
            opacity: 0.8;
        }

        /* Responsive Design */
        @media (max-width: 768px) {
            .header-content {
                flex-direction: column;
                gap: 1rem;
            }
            
            .auth-container {
                width: 100%;
                justify-content: center;
            }
            
            .mode-buttons {
                grid-template-columns: 1fr;
            }
            
            .search-box {
                flex-direction: column;
            }
            
            .search-input, .voice-btn, .search-btn {
                width: 100%;
                border-radius: 0;
            }
            
            .search-input {
                border-radius: 12px 12px 0 0;
            }
            
            .search-btn {
                border-radius: 0 0 12px 12px;
            }
            
            .voice-btn {
                order: -1;
                border-radius: 12px 12px 0 0;
            }
            
            .result-actions {
                flex-direction: column;
                align-items: flex-start;
            }
            
            .action-btn {
                width: 100%;
                justify-content: center;
            }
            
            .footer-content {
                flex-direction: column;
                gap: 1rem;
                text-align: center;
            }
            
            .footer-links {
                flex-wrap: wrap;
                justify-content: center;
            }
        }

        /* Print Styles */
        @media print {
            header, footer, .mode-toggle-section, .search-container, .result-actions, .chat-history-search {
                display: none !important;
            }
            
            .results-container, .units-container {
                box-shadow: none;
                border: 1px solid #ddd;
            }
            
            body {
                background: white;
                color: black;
            }
        }
    </style>
</head>
<body>
    <!-- Header -->
    <header>
        <div class="container">
            <div class="header-content">
                <div class="logo">
                    <span class="logo-icon">🧠</span>
                    <span>Aasai SmartEDU</span>
                </div>
                
                <div class="auth-container">
                    <div id="g_id_onload"
                         data-client_id="YOUR_GOOGLE_CLIENT_ID"
                         data-context="signin"
                         data-ux_mode="popup"
                         data-callback="handleGoogleSignIn"
                         data-auto_prompt="false">
                    </div>

                    <div class="g_id_signin"
                         data-type="standard"
                         data-shape="rectangular"
                         data-theme="filled_blue"
                         data-text="signin_with"
                         data-size="large"
                         data-logo_alignment="left">
                    </div>
                    
                    <div class="user-profile" id="userProfile">
                        <img class="user-avatar" id="userAvatar" src="" alt="User Avatar">
                        <div class="user-info">
                            <div class="user-name" id="userName">User Name</div>
                            <div class="user-email" id="userEmail">user@example.com</div>
                            <div class="user-stats" id="userStats">Questions: 0 | Points: 0</div>
                        </div>
                        <button class="sign-out-btn" id="signOutBtn">Sign Out</button>
                    </div>
                </div>
            </div>
        </div>
    </header>

    <!-- Main Content -->
    <main>
        <div class="container">
            <div class="main-layout">
                <!-- Mode Toggle Section -->
                <section class="mode-toggle-section">
                    <div class="mode-toggle-header">
                        <h2 class="mode-toggle-title">Choose Your Learning Mode</h2>
                        <p class="mode-toggle-subtitle">Select how you'd like to interact with Aasai SmartEDU</p>
                    </div>
                    
                    <div class="mode-buttons">
                        <div class="mode-btn active" id="searchModeBtn">
                            <div class="mode-icon">🔍</div>
                            <h3 class="mode-title">Search Mode</h3>
                            <p class="mode-description">Ask any question and get detailed explanations with examples and step-by-step solutions.</p>
                        </div>
                        
                        <div class="mode-btn" id="unitsModeBtn">
                            <div class="mode-icon">📚</div>
                            <h3 class="mode-title">Units Mode</h3>
                            <p class="mode-description">Browse through organized curriculum units and questions by grade, subject, and chapter.</p>
                        </div>
                    </div>
                    
                    <!-- Course Selection Panel -->
                    <div class="course-selection-panel" id="courseSelectionPanel">
                        <h3 class="course-selection-title">Select Your Course</h3>
                        <div class="selectors-grid">
                            <div class="selector-group">
                                <label for="gradeSelect">Grade</label>
                                <select class="form-select" id="gradeSelect">
                                    <option value="">Select Grade</option>
                                    <option value="8">Grade 8</option>
                                    <option value="9">Grade 9</option>
                                    <option value="10">Grade 10</option>
                                    <option value="11">Grade 11</option>
                                    <option value="12">Grade 12</option>
                                </select>
                            </div>
                            
                            <div class="selector-group">
                                <label for="subjectSelect">Subject</label>
                                <select class="form-select" id="subjectSelect">
                                    <option value="">Select Subject</option>
                                    <option value="math">Mathematics</option>
                                    <option value="science">Science</option>
                                    <option value="english">English</option>
                                    <option value="social">Social Studies</option>
                                    <option value="tamil">Tamil</option>
                                    <option value="malayalam">Malayalam</option>
                                </select>
                            </div>
                            
                            <div class="selector-group">
                                <label for="chapterSelect">Chapter</label>
                                <select class="form-select" id="chapterSelect">
                                    <option value="">Select Chapter</option>
                                </select>
                            </div>
                        </div>
                    </div>
                </section>
                
                <!-- Search Section -->
                <section class="search-container show" id="searchContainer">
                    <div class="search-header">
                        <h2 class="search-title">Ask Aasai SmartEDU</h2>
                        <p class="search-subtitle">Get detailed explanations for any question in your curriculum</p>
                    </div>
                    
                    <div class="language-selector">
                        <label for="languageSelect">Language:</label>
                        <select class="language-select" id="languageSelect">
                            <option value="en">English</option>
                            <option value="ta">Tamil</option>
                            <option value="ml">Malayalam</option>
                            <option value="hi">Hindi</option>
                            <option value="te">Telugu</option>
                            <option value="kn">Kannada</option>
                        </select>
                    </div>
                    
                    <div class="search-box">
                        <input type="text" class="search-input" id="searchInput" placeholder="Ask any question...">
                        <button class="voice-btn" id="voiceBtn">🎤</button>
                        <button class="search-btn" id="searchBtn">Search</button>
                    </div>
                    
                    <div class="voice-status" id="voiceStatus"></div>
                    
                    <div class="loading" id="searchLoading" style="display: none;">
                        <div class="spinner"></div>
                    </div>
                    
                    <div class="results-container" id="resultsContainer">
                        <div class="results-header">
                            <h3 class="results-title">Answer</h3>
                        </div>
                        
                        <div class="result-card">
                            <div class="result-question">
                                <div class="result-question-label">Your Question</div>
                                <div class="result-question-text" id="resultQuestionText">What is photosynthesis?</div>
                            </div>
                            
                            <div class="result-meta">
                                <div class="confidence-badge confidence-high" id="confidenceBadge">High Confidence</div>
                                <div class="response-time" id="responseTime">
                                    <span>⏱️</span>
                                    <span>1.2s</span>
                                </div>
                                <div class="cache-indicator" id="cacheIndicator">Cache Hit</div>
                            </div>
                            
                            <div class="formatted-content" id="resultContent">
                                <p>Photosynthesis is the process by which green plants and some other organisms use sunlight to synthesize foods from carbon dioxide and water. Photosynthesis in plants generally involves the green pigment chlorophyll and generates oxygen as a byproduct.</p>
                            </div>
                            
                            <div class="result-actions">
                                <button class="speaker-btn" id="speakerBtn">
                                    <span>🔊</span>
                                    <span>Listen</span>
                                </button>
                                <button class="action-btn" id="copyBtn">
                                    <span>📋</span>
                                    <span>Copy</span>
                                </button>
                                <button class="feedback-btn" id="likeBtn">
                                    <span>👍</span>
                                    <span>Like</span>
                                </button>
                                <button class="feedback-btn" id="dislikeBtn">
                                    <span>👎</span>
                                    <span>Dislike</span>
                                </button>
                                <button class="feedback-btn" id="reportBtn">
                                    <span>⚠️</span>
                                    <span>Report</span>
                                </button>
                            </div>
                        </div>
                        
                        <div class="chat-history-search" id="chatHistorySearch">
                            <div class="chat-history-header">
                                <h3 class="chat-history-title">Recent Questions</h3>
                                <button class="refresh-btn" id="refreshHistoryBtn">🔄</button>
                            </div>
                            
                            <div class="chat-messages-grid" id="chatMessagesGrid">
                                <div class="no-chat-history" id="noChatHistory">No recent questions found. Start by asking a question!</div>
                            </div>
                            
                            <button class="load-more-btn" id="loadMoreBtn" style="display: none;">Load More</button>
                        </div>
                    </div>
                </section>
                
                <!-- Units Section -->
                <section class="units-container" id="unitsContainer">
                    <div class="units-header">
                        <h2 class="units-title">Curriculum Units</h2>
                        <p class="units-subtitle">Browse questions by chapter and topic</p>
                    </div>
                    
                    <div class="course-info" id="courseInfo">
                        <h4>Grade 10 - Mathematics</h4>
                        <p>Chapter 1: Real Numbers</p>
                    </div>
                    
                    <div class="units-grid" id="unitsGrid">
                        <!-- Units will be dynamically populated here -->
                    </div>
                </section>
            </div>
        </div>
    </main>

    <!-- Footer -->
    <footer>
        <div class="container">
            <div class="footer-content">
                <div class="footer-logo">Aasai SmartEDU</div>
                <div class="footer-links">
                    <a href="#" class="footer-link">Privacy Policy</a>
                    <a href="#" class="footer-link">Terms of Service</a>
                    <a href="#" class="footer-link">Contact Us</a>
                </div>
            </div>
        </div>
    </footer>

    <script>
        // DOM Elements
        const modeToggleSection = document.querySelector('.mode-toggle-section');
        const searchModeBtn = document.getElementById('searchModeBtn');
        const unitsModeBtn = document.getElementById('unitsModeBtn');
        const courseSelectionPanel = document.getElementById('courseSelectionPanel');
        const searchContainer = document.getElementById('searchContainer');
        const unitsContainer = document.getElementById('unitsContainer');
        const gradeSelect = document.getElementById('gradeSelect');
        const subjectSelect = document.getElementById('subjectSelect');
        const chapterSelect = document.getElementById('chapterSelect');
        const languageSelect = document.getElementById('languageSelect');
        const searchInput = document.getElementById('searchInput');
        const voiceBtn = document.getElementById('voiceBtn');
        const searchBtn = document.getElementById('searchBtn');
        const voiceStatus = document.getElementById('voiceStatus');
        const searchLoading = document.getElementById('searchLoading');
        const resultsContainer = document.getElementById('resultsContainer');
        const resultQuestionText = document.getElementById('resultQuestionText');
        const resultContent = document.getElementById('resultContent');
        const confidenceBadge = document.getElementById('confidenceBadge');
        const responseTime = document.getElementById('responseTime');
        const cacheIndicator = document.getElementById('cacheIndicator');
        const speakerBtn = document.getElementById('speakerBtn');
        const copyBtn = document.getElementById('copyBtn');
        const likeBtn = document.getElementById('likeBtn');
        const dislikeBtn = document.getElementById('dislikeBtn');
        const reportBtn = document.getElementById('reportBtn');
        const chatHistorySearch = document.getElementById('chatHistorySearch');
        const chatMessagesGrid = document.getElementById('chatMessagesGrid');
        const noChatHistory = document.getElementById('noChatHistory');
        const loadMoreBtn = document.getElementById('loadMoreBtn');
        const refreshHistoryBtn = document.getElementById('refreshHistoryBtn');
        const courseInfo = document.getElementById('courseInfo');
        const unitsGrid = document.getElementById('unitsGrid');
        const userProfile = document.getElementById('userProfile');
        const userAvatar = document.getElementById('userAvatar');
        const userName = document.getElementById('userName');
        const userEmail = document.getElementById('userEmail');
        const userStats = document.getElementById('userStats');
        const signOutBtn = document.getElementById('signOutBtn');

        // Voice Synthesis Configuration
        const voiceConfig = {
            'en': {
                voiceName: 'Google UK English Male',
                rate: 1.0,
                pitch: 1.0,
                volume: 1.0
            },
            'ta': {
                voiceName: 'Microsoft Valluvar - Tamil (India)',
                rate: 0.9,
                pitch: 1.0,
                volume: 1.0
            },
            'ml': {
                voiceName: 'Microsoft Ananth - Malayalam (India)',
                rate: 0.9,
                pitch: 1.0,
                volume: 1.0
            },
            'hi': {
                voiceName: 'Microsoft Madhur - Hindi (India)',
                rate: 0.9,
                pitch: 1.0,
                volume: 1.0
            },
            'te': {
                voiceName: 'Microsoft Chitra - Telugu (India)',
                rate: 0.9,
                pitch: 1.0,
                volume: 1.0
            },
            'kn': {
                voiceName: 'Microsoft Gagan - Kannada (India)',
                rate: 0.9,
                pitch: 1.0,
                volume: 1.0
            }
        };

        // App State
        let currentMode = 'search';
        let isListening = false;
        let recognition = null;
        let currentUtterance = null;
        let isSpeaking = false;
        let user = null;
        let chatHistory = [];
        let currentUnits = [];

        // Initialize the app
        function initApp() {
            setupEventListeners();
            loadChatHistory();
            checkUserAuth();
            initializeSpeechRecognition();
            initializeSpeechSynthesis();
            
            // Set initial mode
            setMode('search');
        }

        // Set up event listeners
        function setupEventListeners() {
            // Mode toggle
            searchModeBtn.addEventListener('click', () => setMode('search'));
            unitsModeBtn.addEventListener('click', () => setMode('units'));
            
            // Course selection
            gradeSelect.addEventListener('change', updateCourseSelection);
            subjectSelect.addEventListener('change', updateCourseSelection);
            chapterSelect.addEventListener('change', updateCourseSelection);
            
            // Search functionality
            searchBtn.addEventListener('click', performSearch);
            searchInput.addEventListener('keypress', (e) => {
                if (e.key === 'Enter') {
                    performSearch();
                }
            });
            
            // Voice recognition
            voiceBtn.addEventListener('click', toggleVoiceRecognition);
            
            // Result actions
            speakerBtn.addEventListener('click', toggleSpeech);
            copyBtn.addEventListener('click', copyResult);
            likeBtn.addEventListener('click', () => handleFeedback('like'));
            dislikeBtn.addEventListener('click', () => handleFeedback('dislike'));
            reportBtn.addEventListener('click', () => handleFeedback('report'));
            
            // Chat history
            refreshHistoryBtn.addEventListener('click', loadChatHistory);
            loadMoreBtn.addEventListener('click', loadMoreHistory);
            
            // Sign out
            signOutBtn.addEventListener('click', handleSignOut);
        }

        // Set the current mode
        function setMode(mode) {
            currentMode = mode;
            
            // Update UI
            searchModeBtn.classList.toggle('active', mode === 'search');
            unitsModeBtn.classList.toggle('active', mode === 'units');
            
            courseSelectionPanel.classList.toggle('show', mode === 'units');
            searchContainer.classList.toggle('show', mode === 'search');
            unitsContainer.classList.toggle('show', mode === 'units');
            
            if (mode === 'units') {
                loadUnitsData();
            }
        }

        // Update course selection
        function updateCourseSelection() {
            const grade = gradeSelect.value;
            const subject = subjectSelect.value;
            
            if (grade && subject) {
                // Update chapter options based on grade and subject
                updateChapterOptions(grade, subject);
                
                // Update course info display
                courseInfo.innerHTML = `
                    <h4>Grade ${grade} - ${getSubjectName(subject)}</h4>
                    <p>Chapter ${chapterSelect.value}: ${chapterSelect.options[chapterSelect.selectedIndex]?.text || 'Select Chapter'}</p>
                `;
                
                // Load units if chapter is selected
                if (chapterSelect.value) {
                    loadUnitsData();
                }
            }
        }

        // Update chapter options based on grade and subject
        function updateChapterOptions(grade, subject) {
            // Clear existing options
            chapterSelect.innerHTML = '<option value="">Select Chapter</option>';
            
            // Add mock chapters based on grade and subject
            const chapters = getChaptersForSubject(grade, subject);
            
            chapters.forEach(chapter => {
                const option = document.createElement('option');
                option.value = chapter.number;
                option.textContent = `${chapter.number}: ${chapter.title}`;
                chapterSelect.appendChild(option);
            });
        }

        // Get subject name from value
        function getSubjectName(subject) {
            const subjects = {
                'math': 'Mathematics',
                'science': 'Science',
                'english': 'English',
                'social': 'Social Studies',
                'tamil': 'Tamil',
                'malayalam': 'Malayalam'
            };
            
            return subjects[subject] || subject;
        }

        // Get mock chapters for a subject
        function getChaptersForSubject(grade, subject) {
            // This is mock data - in a real app, this would come from an API
            const chapters = {
                'math': [
                    { number: 1, title: 'Real Numbers' },
                    { number: 2, title: 'Polynomials' },
                    { number: 3, title: 'Pair of Linear Equations' },
                    { number: 4, title: 'Quadratic Equations' },
                    { number: 5, title: 'Arithmetic Progressions' }
                ],
                'science': [
                    { number: 1, title: 'Chemical Reactions' },
                    { number: 2, title: 'Acids, Bases and Salts' },
                    { number: 3, title: 'Metals and Non-metals' },
                    { number: 4, title: 'Carbon and its Compounds' },
                    { number: 5, title: 'Periodic Classification' }
                ],
                'tamil': [
                    { number: 1, title: 'தமிழ் மொழி' },
                    { number: 2, title: 'இலக்கணம்' },
                    { number: 3, title: 'இலக்கியம்' },
                    { number: 4, title: 'கவிதைகள்' },
                    { number: 5, title: 'கட்டுரைகள்' }
                ],
                'malayalam': [
                    { number: 1, title: 'മലയാളം ഭാഷ' },
                    { number: 2, title: 'വ്യാകരണം' },
                    { number: 3, title: 'സാഹിത്യം' },
                    { number: 4, title: 'കവിതകൾ' },
                    { number: 5, title: 'ലേഖനങ്ങൾ' }
                ]
            };
            
            return chapters[subject] || [
                { number: 1, title: 'Chapter 1' },
                { number: 2, title: 'Chapter 2' },
                { number: 3, title: 'Chapter 3' }
            ];
        }

        // Load units data
        function loadUnitsData() {
            const grade = gradeSelect.value;
            const subject = subjectSelect.value;
            const chapter = chapterSelect.value;
            
            if (!grade || !subject || !chapter) {
                unitsGrid.innerHTML = '<div class="no-results">Please select grade, subject, and chapter to view units.</div>';
                return;
            }
            
            // Show loading
            unitsGrid.innerHTML = '<div class="loading"><div class="spinner"></div></div>';
            
            // Simulate API call with timeout
            setTimeout(() => {
                // Mock units data
                currentUnits = generateMockUnits(grade, subject, chapter);
                renderUnits();
            }, 1000);
        }

        // Generate mock units data
        function generateMockUnits(grade, subject, chapter) {
            // This is mock data - in a real app, this would come from an API
            return [
                {
                    id: 1,
                    title: 'Introduction',
                    icon: '📖',
                    questions: [
                        {
                            id: 101,
                            type: 'definition',
                            text: 'What is the definition of this concept?',
                            answer: 'This concept refers to the fundamental principles that govern this topic. It includes key elements such as...'
                        },
                        {
                            id: 102,
                            type: 'example',
                            text: 'Can you provide an example of this concept?',
                            answer: 'Sure! Here is a practical example: [detailed example with step-by-step explanation]'
                        }
                    ]
                },
                {
                    id: 2,
                    title: 'Key Concepts',
                    icon: '🔑',
                    questions: [
                        {
                            id: 201,
                            type: 'explanation',
                            text: 'Explain the main principles involved.',
                            answer: 'The main principles include: 1) First principle, 2) Second principle, 3) Third principle. Each of these plays a crucial role in...'
                        },
                        {
                            id: 202,
                            type: 'application',
                            text: 'How is this applied in real-world scenarios?',
                            answer: 'This concept is applied in various real-world scenarios such as: [detailed applications with examples]'
                        },
                        {
                            id: 203,
                            type: 'comparison',
                            text: 'Compare this concept with similar ones.',
                            answer: 'When comparing this concept with similar ones, we find key differences in: [detailed comparison table]'
                        }
                    ]
                },
                {
                    id: 3,
                    title: 'Problem Solving',
                    icon: '🧮',
                    questions: [
                        {
                            id: 301,
                            type: 'calculation',
                            text: 'Solve this sample problem step by step.',
                            answer: 'Let\'s solve this problem step by step:\n\nStep 1: Identify the given values\nStep 2: Apply the formula\nStep 3: Calculate the result\nStep 4: Verify the answer\n\n[Detailed solution with calculations]'
                        },
                        {
                            id: 302,
                            type: 'proof',
                            text: 'Prove this theorem or formula.',
                            answer: 'To prove this theorem, we will follow these steps:\n\n1. State the given conditions\n2. Apply relevant principles\n3. Derive the conclusion\n4. Verify the proof\n\n[Detailed proof with mathematical expressions]'
                        }
                    ]
                }
            ];
        }

        // Render units to the UI
        function renderUnits() {
            if (currentUnits.length === 0) {
                unitsGrid.innerHTML = '<div class="no-results">No units found for the selected criteria.</div>';
                return;
            }
            
            let html = '';
            
            currentUnits.forEach(unit => {
                let questionsHtml = '';
                
                // Group questions by type
                const questionsByType = {};
                unit.questions.forEach(question => {
                    if (!questionsByType[question.type]) {
                        questionsByType[question.type] = [];
                    }
                    questionsByType[question.type].push(question);
                });
                
                // Generate HTML for each question type section
                Object.keys(questionsByType).forEach(type => {
                    const questions = questionsByType[type];
                    const typeTitle = getQuestionTypeTitle(type);
                    
                    let typeQuestionsHtml = '';
                    
                    questions.forEach((question, index) => {
                        typeQuestionsHtml += `
                            <div class="question-item">
                                <div class="question-header" onclick="toggleQuestionAnswer(${question.id})">
                                    <div class="question-left">
                                        <div class="question-number">${index + 1}</div>
                                        <div class="question-text">${question.text}</div>
                                    </div>
                                    <button class="question-toggle">+</button>
                                </div>
                                <div class="question-answer" id="answer-${question.id}">
                                    <div class="answer-content">
                                        <div class="formatted-content">${formatAnswer(question.answer)}</div>
                                        <div class="answer-actions">
                                            <button class="speaker-btn" onclick="speakAnswer('${question.answer.replace(/'/g, "\\'")}')">
                                                <span>🔊</span>
                                                <span>Listen</span>
                                            </button>
                                            <button class="action-btn" onclick="copyAnswer('${question.answer.replace(/'/g, "\\'")}')">
                                                <span>📋</span>
                                                <span>Copy</span>
                                            </button>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        `;
                    });
                    
                    questionsHtml += `
                        <div class="question-section">
                            <div class="question-section-header">
                                <div class="question-type-title">${typeTitle}</div>
                                <div class="question-count">${questions.length} Questions</div>
                            </div>
                            <div class="questions-list">
                                ${typeQuestionsHtml}
                            </div>
                        </div>
                    `;
                });
                
                html += `
                    <div class="unit-card">
                        <div class="unit-header" onclick="toggleUnitContent(${unit.id})">
                            <h3 class="unit-title">
                                <span class="unit-icon">${unit.icon}</span>
                                <span>${unit.title}</span>
                            </h3>
                            <button class="unit-toggle">+</button>
                        </div>
                        <div class="unit-content" id="unit-${unit.id}">
                            ${questionsHtml}
                        </div>
                    </div>
                `;
            });
            
            unitsGrid.innerHTML = html;
        }

        // Get question type title
        function getQuestionTypeTitle(type) {
            const titles = {
                'definition': 'Definitions',
                'example': 'Examples',
                'explanation': 'Explanations',
                'application': 'Applications',
                'comparison': 'Comparisons',
                'calculation': 'Calculations',
                'proof': 'Proofs'
            };
            
            return titles[type] || type;
        }

        // Toggle unit content
        function toggleUnitContent(unitId) {
            const unitContent = document.getElementById(`unit-${unitId}`);
            const unitToggle = unitContent.previousElementSibling.querySelector('.unit-toggle');
            const unitHeader = unitContent.previousElementSibling;
            
            if (unitContent.classList.contains('show')) {
                unitContent.classList.remove('show');
                unitToggle.textContent = '+';
                unitHeader.classList.remove('active');
            } else {
                unitContent.classList.add('show');
                unitToggle.textContent = '−';
                unitHeader.classList.add('active');
            }
        }

        // Toggle question answer
        function toggleQuestionAnswer(questionId) {
            const answer = document.getElementById(`answer-${questionId}`);
            const questionToggle = answer.previousElementSibling.querySelector('.question-toggle');
            const questionHeader = answer.previousElementSibling;
            
            if (answer.classList.contains('show')) {
                answer.classList.remove('show');
                questionToggle.textContent = '+';
                questionHeader.classList.remove('active');
            } else {
                answer.classList.add('show');
                questionToggle.textContent = '−';
                questionHeader.classList.add('active');
            }
        }

        // Format answer text
        function formatAnswer(text) {
            // Simple formatting for demonstration
            // In a real app, you would use a more sophisticated formatting system
            return text.replace(/\n/g, '<br>');
        }

        // Speak answer text
        function speakAnswer(text) {
            const language = languageSelect.value;
            speakText(text, language);
        }

        // Copy answer text
        function copyAnswer(text) {
            navigator.clipboard.writeText(text).then(() => {
                // Show success feedback
                const originalText = copyBtn.innerHTML;
                copyBtn.innerHTML = '<span>✓</span><span>Copied!</span>';
                setTimeout(() => {
                    copyBtn.innerHTML = originalText;
                }, 2000);
            }).catch(err => {
                console.error('Failed to copy text: ', err);
            });
        }

        // Perform search
        function performSearch() {
            const query = searchInput.value.trim();
            const language = languageSelect.value;
            
            if (!query) {
                alert('Please enter a question to search.');
                return;
            }
            
            // Show loading
            searchLoading.style.display = 'flex';
            resultsContainer.classList.remove('show');
            
            // Simulate API call with timeout
            setTimeout(() => {
                // Generate mock response
                const response = generateMockResponse(query, language);
                
                // Update UI with response
                resultQuestionText.textContent = query;
                resultContent.innerHTML = formatResponse(response.answer);
                confidenceBadge.textContent = response.confidence;
                confidenceBadge.className = `confidence-badge confidence-${response.confidence.toLowerCase()}`;
                responseTime.querySelector('span:last-child').textContent = `${response.responseTime}s`;
                cacheIndicator.textContent = response.cacheHit ? 'Cache Hit' : 'Cache Miss';
                cacheIndicator.classList.toggle('cache-hit', response.cacheHit);
                
                // Add to chat history
                addToChatHistory(query, response.answer);
                
                // Hide loading and show results
                searchLoading.style.display = 'none';
                resultsContainer.classList.add('show');
                
                // Scroll to results
                resultsContainer.scrollIntoView({ behavior: 'smooth' });
            }, 1500);
        }

        // Generate mock response
        function generateMockResponse(query, language) {
            // This is mock data - in a real app, this would come from an API
            const responses = {
                'en': {
                    answer: `**${query}**\n\nThis is a detailed explanation for your question. In simple terms, the answer involves several key concepts that are important to understand.\n\n### Key Points:\n- First important point with detailed explanation\n- Second important point with examples\n- Third important point with practical applications\n\n### Step-by-Step Explanation:\n1. **Step One**: Begin with the basics and foundational concepts.\n2. **Step Two**: Build upon these concepts with more detailed information.\n3. **Step Three**: Apply the concepts to practical scenarios.\n4. **Step Four**: Review and summarize the key takeaways.\n\n### Example:\nHere's a practical example to illustrate the concept:\n\n\\[ \\text{Example Formula: } E = mc^2 \\]\n\nThis famous equation demonstrates the relationship between energy and mass.\n\n### Additional Resources:\n- Related concepts you might find helpful\n- Further reading suggestions\n- Practice problems to test your understanding`,
                    confidence: 'High',
                    responseTime: (Math.random() * 2 + 0.5).toFixed(1),
                    cacheHit: Math.random() > 0.5
                },
                'ta': {
                    answer: `**${query}**\n\nஇது உங்கள் கேள்விக்கான விரிவான விளக்கம். இந்த கருத்தை புரிந்துகொள்வதற்கு பல முக்கிய கருத்துகள் உள்ளன.\n\n### முக்கிய புள்ளிகள்:\n- முதல் முக்கிய புள்ளி விளக்கத்துடன்\n- இரண்டாவது முக்கிய புள்ளி எடுத்துக்காட்டுகளுடன்\n- மூன்றாவது முக்கிய புள்ளி நடைமுறை பயன்பாடுகளுடன்\n\n### படிப்படியான விளக்கம்:\n1. **முதல் படி**: அடிப்படை கருத்துகளுடன் தொடங்கவும்\n2. **இரண்டாம் படி**: இந்த கருத்துகளின் மேல் விரிவான தகவல்களை கட்டமைக்கவும்\n3. **மூன்றாம் படி**: நடைமுறை சூழ்நிலைகளில் கருத்துகளை பயன்படுத்தவும்\n4. **நான்காம் படி**: முக்கிய கருத்துகளை மதிப்பாய்வு செய்து சுருக்கவும்\n\n### எடுத்துக்காட்டு:\nகருத்தை விளக்க ஒரு நடைமுறை எடுத்துக்காட்டு:\n\n\\[ E = mc^2 \\]\n\nஇந்த பிரபலமான சமன்பாடு ஆற்றல் மற்றும் நிறைக்கு இடையே உள்ள தொடர்பை காட்டுகிறது.`,
                    confidence: 'High',
                    responseTime: (Math.random() * 2 + 0.5).toFixed(1),
                    cacheHit: Math.random() > 0.5
                },
                'ml': {
                    answer: `**${query}**\n\nഇത് നിങ്ങളുടെ ചോദ്യത്തിനുള്ള വിശദമായ വിശദീകരണമാണ്. ഈ ആശയം മനസ്സിലാക്കുന്നതിന് നിരവധി പ്രധാന ആശയങ്ങൾ ഉണ്ട്.\n\n### പ്രധാന പോയിന്റുകൾ:\n- വിശദീകരണത്തോടെയുള്ള ആദ്യത്തെ പ്രധാന പോയിന്റ്\n- ഉദാഹരണങ്ങളോടെയുള്ള രണ്ടാമത്തെ പ്രധാന പോയിന്റ്\n- പ്രായോഗിക ആപ്ലിക്കേഷനുകളോടെയുള്ള മൂന്നാമത്തെ പ്രധാന പോയിന്റ്\n\n### ഘട്ടം ഘട്ടമായുള്ള വിശദീകരണം:\n1. **ആദ്യ ഘട്ടം**: അടിസ്ഥാന ആശയങ്ങളിൽ നിന്ന് ആരംഭിക്കുക\n2. **രണ്ടാം ഘട്ടം**: കൂടുതൽ വിശദമായ വിവരങ്ങൾ ഉപയോഗിച്ച് ഈ ആശയങ്ങൾ നിർമ്മിക്കുക\n3. **മൂന്നാം ഘട്ടം**: പ്രായോഗിക സാഹചര്യങ്ങളിൽ ആശയങ്ങൾ പ്രയോഗിക്കുക\n4. **നാലാം ഘട്ടം**: പ്രധാന ആശയങ്ങൾ അവലോകനം ചെയ്ത് സംഗ്രഹിക്കുക\n\n### ഉദാഹരണം:\nആശയം വിശദീകരിക്കാൻ ഒരു പ്രായോഗിക ഉദാഹരണം:\n\n\\[ E = mc^2 \\]\n\nഈ പ്രശസ്തമായ സമവാക്യം ഊർജ്ജത്തിനും പിണ്ഡത്തിനും ഇടയിലുള്ള ബന്ധം കാണിക്കുന്നു.`,
                    confidence: 'High',
                    responseTime: (Math.random() * 2 + 0.5).toFixed(1),
                    cacheHit: Math.random() > 0.5
                }
            };
            
            return responses[language] || responses['en'];
        }

        // Format response text
        function formatResponse(text) {
            // Use marked.js to parse markdown
            return marked.parse(text);
        }

        // Add to chat history
        function addToChatHistory(question, answer) {
            const chatItem = {
                id: Date.now(),
                question,
                answer: answer.substring(0, 100) + '...',
                timestamp: new Date().toLocaleString()
            };
            
            chatHistory.unshift(chatItem);
            
            // Keep only last 20 items
            if (chatHistory.length > 20) {
                chatHistory = chatHistory.slice(0, 20);
            }
            
            // Save to localStorage
            localStorage.setItem('aasaiChatHistory', JSON.stringify(chatHistory));
            
            // Update UI
            renderChatHistory();
        }

        // Load chat history
        function loadChatHistory() {
            const savedHistory = localStorage.getItem('aasaiChatHistory');
            
            if (savedHistory) {
                chatHistory = JSON.parse(savedHistory);
            }
            
            renderChatHistory();
        }

        // Render chat history
        function renderChatHistory() {
            if (chatHistory.length === 0) {
                noChatHistory.style.display = 'block';
                chatMessagesGrid.innerHTML = '';
                loadMoreBtn.style.display = 'none';
                return;
            }
            
            noChatHistory.style.display = 'none';
            
            let html = '';
            const itemsToShow = Math.min(chatHistory.length, 6);
            
            for (let i = 0; i < itemsToShow; i++) {
                const item = chatHistory[i];
                html += `
                    <div class="chat-message-item" onclick="loadChatItem(${item.id})">
                        <div class="chat-question">${item.question}</div>
                        <div class="chat-answer">${item.answer}</div>
                        <div class="chat-message-meta">
                            <span>${item.timestamp}</span>
                        </div>
                    </div>
                `;
            }
            
            chatMessagesGrid.innerHTML = html;
            
            // Show load more button if there are more items
            if (chatHistory.length > 6) {
                loadMoreBtn.style.display = 'block';
            } else {
                loadMoreBtn.style.display = 'none';
            }
        }

        // Load more chat history
        function loadMoreHistory() {
            const currentCount = chatMessagesGrid.children.length;
            const itemsToShow = Math.min(chatHistory.length, currentCount + 6);
            
            let html = chatMessagesGrid.innerHTML;
            
            for (let i = currentCount; i < itemsToShow; i++) {
                const item = chatHistory[i];
                html += `
                    <div class="chat-message-item" onclick="loadChatItem(${item.id})">
                        <div class="chat-question">${item.question}</div>
                        <div class="chat-answer">${item.answer}</div>
                        <div class="chat-message-meta">
                            <span>${item.timestamp}</span>
                        </div>
                    </div>
                `;
            }
            
            chatMessagesGrid.innerHTML = html;
            
            // Hide load more button if all items are shown
            if (itemsToShow >= chatHistory.length) {
                loadMoreBtn.style.display = 'none';
            }
        }

        // Load chat item
        function loadChatItem(id) {
            const item = chatHistory.find(chat => chat.id === id);
            
            if (item) {
                searchInput.value = item.question;
                performSearch();
            }
        }

        // Initialize speech recognition
        function initializeSpeechRecognition() {
            if ('webkitSpeechRecognition' in window || 'SpeechRecognition' in window) {
                const SpeechRecognition = window.SpeechRecognition || window.webkitSpeechRecognition;
                recognition = new SpeechRecognition();
                
                recognition.continuous = false;
                recognition.interimResults = false;
                recognition.lang = 'en-US';
                
                recognition.onstart = function() {
                    isListening = true;
                    voiceBtn.classList.add('recording');
                    voiceStatus.textContent = 'Listening... Speak now';
                    voiceStatus.className = 'voice-status show listening';
                };
                
                recognition.onresult = function(event) {
                    const transcript = event.results[0][0].transcript;
                    searchInput.value = transcript;
                    isListening = false;
                    voiceBtn.classList.remove('recording');
                    voiceStatus.textContent = 'Processing...';
                    voiceStatus.className = 'voice-status show processing';
                    
                    // Perform search after a short delay
                    setTimeout(() => {
                        performSearch();
                        voiceStatus.classList.remove('show');
                    }, 1000);
                };
                
                recognition.onerror = function(event) {
                    console.error('Speech recognition error', event.error);
                    isListening = false;
                    voiceBtn.classList.remove('recording');
                    voiceStatus.textContent = `Error: ${event.error}`;
                    voiceStatus.className = 'voice-status show';
                    
                    setTimeout(() => {
                        voiceStatus.classList.remove('show');
                    }, 3000);
                };
                
                recognition.onend = function() {
                    isListening = false;
                    voiceBtn.classList.remove('recording');
                    
                    if (voiceStatus.textContent === 'Listening... Speak now') {
                        voiceStatus.textContent = 'No speech detected';
                        setTimeout(() => {
                            voiceStatus.classList.remove('show');
                        }, 2000);
                    }
                };
            } else {
                voiceBtn.disabled = true;
                voiceBtn.title = 'Speech recognition not supported in this browser';
            }
        }

        // Toggle voice recognition
        function toggleVoiceRecognition() {
            if (!recognition) {
                alert('Speech recognition is not supported in your browser.');
                return;
            }
            
            if (isListening) {
                recognition.stop();
            } else {
                // Set language based on selection
                const language = languageSelect.value;
                recognition.lang = getSpeechRecognitionLanguage(language);
                recognition.start();
            }
        }

        // Get speech recognition language code
        function getSpeechRecognitionLanguage(language) {
            const languages = {
                'en': 'en-US',
                'ta': 'ta-IN',
                'ml': 'ml-IN',
                'hi': 'hi-IN',
                'te': 'te-IN',
                'kn': 'kn-IN'
            };
            
            return languages[language] || 'en-US';
        }

        // Initialize speech synthesis
        function initializeSpeechSynthesis() {
            // Check if speech synthesis is supported
            if (!('speechSynthesis' in window)) {
                speakerBtn.disabled = true;
                speakerBtn.title = 'Text-to-speech not supported in this browser';
            }
        }

        // Speak text
        function speakText(text, language) {
            if (!('speechSynthesis' in window)) {
                alert('Text-to-speech is not supported in your browser.');
                return;
            }
            
            // Cancel any ongoing speech
            if (isSpeaking) {
                window.speechSynthesis.cancel();
                isSpeaking = false;
                speakerBtn.classList.remove('speaking');
                return;
            }
            
            // Create a new utterance
            const utterance = new SpeechSynthesisUtterance(text);
            
            // Configure voice based on language
            const config = voiceConfig[language] || voiceConfig['en'];
            
            utterance.rate = config.rate;
            utterance.pitch = config.pitch;
            utterance.volume = config.volume;
            
            // Try to find a suitable voice
            const voices = window.speechSynthesis.getVoices();
            let voice = voices.find(v => v.name === config.voiceName);
            
            if (!voice) {
                // Fallback to any voice that matches the language
                voice = voices.find(v => v.lang.startsWith(language));
            }
            
            if (voice) {
                utterance.voice = voice;
            }
            
            // Set up event handlers
            utterance.onstart = function() {
                isSpeaking = true;
                speakerBtn.classList.add('speaking');
            };
            
            utterance.onend = function() {
                isSpeaking = false;
                speakerBtn.classList.remove('speaking');
            };
            
            utterance.onerror = function(event) {
                console.error('Speech synthesis error', event);
                isSpeaking = false;
                speakerBtn.classList.remove('speaking');
                alert('Error with text-to-speech. Please try again.');
            };
            
            // Start speaking
            window.speechSynthesis.speak(utterance);
            currentUtterance = utterance;
        }

        // Toggle speech
        function toggleSpeech() {
            const text = resultContent.textContent || resultContent.innerText;
            const language = languageSelect.value;
            
            if (isSpeaking) {
                window.speechSynthesis.cancel();
                isSpeaking = false;
                speakerBtn.classList.remove('speaking');
            } else {
                speakText(text, language);
            }
        }

        // Copy result
        function copyResult() {
            const text = resultContent.textContent || resultContent.innerText;
            
            navigator.clipboard.writeText(text).then(() => {
                // Show success feedback
                const originalText = copyBtn.innerHTML;
                copyBtn.innerHTML = '<span>✓</span><span>Copied!</span>';
                setTimeout(() => {
                    copyBtn.innerHTML = originalText;
                }, 2000);
            }).catch(err => {
                console.error('Failed to copy text: ', err);
            });
        }

        // Handle feedback
        function handleFeedback(type) {
            const buttons = {
                'like': likeBtn,
                'dislike': dislikeBtn,
                'report': reportBtn
            };
            
            const button = buttons[type];
            
            // Toggle active state
            if (button.classList.contains(`active-${type}`)) {
                button.classList.remove(`active-${type}`);
            } else {
                // Remove active state from all feedback buttons
                likeBtn.classList.remove('active-like');
                dislikeBtn.classList.remove('active-dislike');
                reportBtn.classList.remove('active-report');
                
                // Add active state to clicked button
                button.classList.add(`active-${type}`);
            }
            
            // In a real app, you would send this feedback to your backend
            console.log(`Feedback: ${type}`);
        }

        // Check user authentication
        function checkUserAuth() {
            // In a real app, you would check if the user is authenticated
            // For demo purposes, we'll simulate a logged-out state
            user = null;
            userProfile.classList.remove('show');
        }

        // Handle Google Sign-In
        function handleGoogleSignIn(response) {
            // This would be handled by your backend in a real app
            console.log('Google Sign-In response:', response);
            
            // For demo purposes, we'll simulate a successful login
            user = {
                name: 'Demo User',
                email: 'demo@aasai.com',
                avatar: 'https://via.placeholder.com/32',
                questions: 15,
                points: 120
            };
            
            updateUserProfile();
        }

        // Update user profile
        function updateUserProfile() {
            if (user) {
                userAvatar.src = user.avatar;
                userName.textContent = user.name;
                userEmail.textContent = user.email;
                userStats.textContent = `Questions: ${user.questions} | Points: ${user.points}`;
                userProfile.classList.add('show');
            } else {
                userProfile.classList.remove('show');
            }
        }

        // Handle sign out
        function handleSignOut() {
            // In a real app, you would sign out from Google
            user = null;
            userProfile.classList.remove('show');
        }

        // Initialize the app when the DOM is loaded
        document.addEventListener('DOMContentLoaded', initApp);

        // Make functions available globally for onclick handlers
        window.toggleUnitContent = toggleUnitContent;
        window.toggleQuestionAnswer = toggleQuestionAnswer;
        window.speakAnswer = speakAnswer;
        window.copyAnswer = copyAnswer;
        window.loadChatItem = loadChatItem;
    </script>
</body>
</html>
